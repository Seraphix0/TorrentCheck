CREATE TABLE [dbo].[USER]
(
	[Id] INT NOT NULL PRIMARY KEY, 
    [Name] VARCHAR(32) NOT NULL, 
    [Description] TEXT NULL, 
    [TrustRating] INT NOT NULL, 
    [UseRecentFilter] BIT NOT NULL, 
    [RecentFilter] NCHAR(10) NULL, 
    [CustomThemePath] VARCHAR(MAX) NULL, 
);

CREATE TABLE [dbo].[TORRENT]
(
	[Id] INT NOT NULL PRIMARY KEY, 
    [Title] VARCHAR(MAX) NOT NULL, 
    [Size] INT NOT NULL, 
    [UploadDate] DATETIME NOT NULL, 
    [Md5Sum] VARCHAR(32) NOT NULL, 
	[USER_Id] INT NOT NULL, 
    CONSTRAINT [FK_TORRENT_UPLOADER] FOREIGN KEY ([USER_Id]) REFERENCES [USER]([Id])
);

CREATE TABLE [dbo].[COMMENT]
(
	[Id] INT NOT NULL PRIMARY KEY, 
    [Text] TEXT NOT NULL, 
    [TORRENT_Id] INT NOT NULL, 
    [USER_Id] INT NOT NULL, 
    CONSTRAINT [FK_COMMENT_TORRENT] FOREIGN KEY ([TORRENT_Id]) REFERENCES [TORRENT]([Id]), 
    CONSTRAINT [FK_COMMENT_USER] FOREIGN KEY ([USER_Id]) REFERENCES [USER]([Id]) 
);

CREATE TABLE [dbo].[FILE]
(
	[Id] INT NOT NULL PRIMARY KEY, 
    [Name] VARCHAR(MAX) NOT NULL, 
    [Size] INT NOT NULL, 
    [TORRENT_Id] INT NOT NULL, 
    CONSTRAINT [FK_FILE_TORRENT] FOREIGN KEY ([TORRENT_Id]) REFERENCES [TORRENT]([Id]), 
);

CREATE TABLE [dbo].[USERDOWNLOADS]
(
	[TORRENT_Id] INT NOT NULL , 
    [USER_Id] INT NOT NULL, 
    [HasRated] BIT NOT NULL, 
    CONSTRAINT [PK_USERDOWNLOADS] PRIMARY KEY ([USER_Id], [TORRENT_Id]), 
    CONSTRAINT [FK_USERDOWNLOADS_TORRENT] FOREIGN KEY ([TORRENT_Id]) REFERENCES [TORRENT]([Id]), 
    CONSTRAINT [FK_USERDOWNLOADS_USER] FOREIGN KEY ([USER_Id]) REFERENCES [USER]([Id]) 
);

CREATE TABLE [dbo].[TORRENTRATING]
(
	[TORRENT_Id] INT NOT NULL , 
    [RATEDBY_USER_Id] INT NOT NULL, 
    [Value] INT NOT NULL, 
    [Description] TEXT NULL, 
    CONSTRAINT [PK_TORRENTRATING] PRIMARY KEY ([RATEDBY_USER_Id], [TORRENT_Id]), 
    CONSTRAINT [FK_TORRENTRATING_TORRENT] FOREIGN KEY ([TORRENT_Id]) REFERENCES [TORRENT]([Id]), 
    CONSTRAINT [FK_TORRENTRATING_USER] FOREIGN KEY ([RATEDBY_USER_Id]) REFERENCES [USER]([Id]) 
);

CREATE TABLE [dbo].[USERRATING]
(
	[USER_Id] INT NOT NULL , 
    [RATEDBY_USER_Id] INT NOT NULL, 
    [Value] INT NOT NULL, 
    [Description] TEXT NULL, 
    CONSTRAINT [PK_USERRATING] PRIMARY KEY ([RATEDBY_USER_Id], [USER_Id]), 
    CONSTRAINT [FK_USERRATING_RATED] FOREIGN KEY ([USER_Id]) REFERENCES [USER]([Id]), 
    CONSTRAINT [FK_USERRATING_POSTER] FOREIGN KEY ([RATEDBY_USER_Id]) REFERENCES [USER]([Id]) 
);
